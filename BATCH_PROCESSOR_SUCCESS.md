# ‚úÖ batch_processor.py - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢!

## üéâ –£—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç - 1 –¥–µ–∫–∞–±—Ä—è 2025

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:

```
[14:48:53] [INFO] [+] Downloading remote config: https://gist...
[14:48:55] [INFO] [OK] Remote config parsed as JSON
[14:48:55] [INFO] [OK] Remote config merged: ['video']
[14:48:55] [INFO]   video params: {'input_dir': 'input/c1', 'mode': 'both', ...}
[14:48:56] [INFO] [OK] B2 client initialized
[14:48:56] [INFO] [OK] Vast.ai client initialized
[14:48:56] [INFO] [DIR] Processing batch from: input/c1      ‚úÖ
[14:48:56] [INFO] [LIST] Listing files from B2: input/c1
[14:48:59] [INFO] [OK] Found 1 video files                    ‚úÖ
[14:49:01] [INFO] [STAT] 1 files to process                   ‚úÖ
```

**–í–°–Å –†–ê–ë–û–¢–ê–ï–¢!** üéä

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. Remote Config
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ URL
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ JSON
- ‚úÖ Deep merge —Å –ª–æ–∫–∞–ª—å–Ω—ã–º config
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```
CLI args > video.input_dir (remote) > batch.input_dir (local)
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
- `video.input_dir: "input/c1"` –∏–∑ remote config
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `batch.input_dir: "input/queue"` –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ config
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `input/c1`

### 3. Credentials –∏–∑ .env
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ `.env` —Ñ–∞–π–ª–∞
- ‚úÖ B2 client –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Vast.ai client –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

### 4. B2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ B2
- ‚úÖ –õ–∏—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ 1 –≤–∏–¥–µ–æ

### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ ASCII-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã (–±–µ–∑ emoji)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –º–µ—Ç–∫–∏: [INFO], [OK], [DIR], [LIST]
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—É—Å–∫:

```bash
python batch_processor.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è remote config –∏–∑ `config_url`
- –ë–µ—Ä—ë—Ç—Å—è `input_dir` –∏–∑ remote config
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```bash
# –î—Ä—É–≥–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
python batch_processor.py --input-dir input/urgent

# Dry run
python batch_processor.py --dry-run

# –î—Ä—É–≥–æ–π preset
python batch_processor.py --preset high
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config.yaml (–ª–æ–∫–∞–ª—å–Ω—ã–π):
```yaml
config_url: "https://gist.github.com/.../config.json"

batch:
  input_dir: "input/queue"   # ‚Üê fallback –µ—Å–ª–∏ remote –Ω–µ —É–∫–∞–∑–∞–Ω
  preset: "balanced"
```

### config.json (remote):
```json
{
  "video": {
    "input_dir": "input/c1",  // ‚Üê –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ!
    "mode": "both",
    "scale": 2,
    "target_fps": 60
  }
}
```

### .env (credentials):
```env
B2_KEY=your_key_id
B2_SECRET=your_application_key
B2_BUCKET=noxfvr-videos
VAST_API_KEY=your_vast_api_key
```

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 |
|----------|-------------|-------------|-------------|
| input_dir | CLI `--input-dir` | Remote `video.input_dir` | Local `batch.input_dir` |
| preset | CLI `--preset` | Local `batch.preset` | Default |
| dry_run | CLI `--dry-run` | Local `batch.dry_run` | False |

**Remote config –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π!** ‚úÖ

---

## üé® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ë—ã—Å—Ç—Ä—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```bash
# –ò–∑–º–µ–Ω–∏–ª –≤ Gist: "input_dir": "input/urgent"
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª:
python batch_processor.py
# ‚úÖ –°—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é!
```

### 2. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```json
// –í–µ—Ä—Å–∏—è A
{"video": {"input_dir": "input/test_a"}}

// –í–µ—Ä—Å–∏—è B
{"video": {"input_dir": "input/test_b"}}
```

### 3. –†–∞–∑–Ω—ã–µ —Å—Ä–µ–¥—ã
```yaml
# Production
config_url: "https://gist.com/.../prod.json"

# Staging
config_url: "https://gist.com/.../staging.json"
```

### 4. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CLI
```bash
# Remote config –≥–æ–≤–æ—Ä–∏—Ç: input/c1
# –ù–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:
python batch_processor.py --input-dir input/urgent
```

---

## ‚úÖ –ò—Ç–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| Remote config –∑–∞–≥—Ä—É–∑–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| Remote config merge | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π |
| .env –∑–∞–≥—Ä—É–∑–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| B2 client | ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω |
| Vast.ai client | ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω |
| B2 –ª–∏—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–Ω–∞–π–¥–µ–Ω–æ 1 —Ñ–∞–π–ª) |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ ASCII-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ |

**–í—Å—ë –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

1. **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª—ã:**
```bash
python batch_processor.py
# –û–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ input/c1
```

2. **Dry run (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫):**
```bash
python batch_processor.py --dry-run
# –ü–æ–∫–∞–∂–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
```

3. **–ò–∑–º–µ–Ω–∏—Ç—å remote config:**
```json
// –û–±–Ω–æ–≤–∏—Ç—å –≤ Gist
{"video": {"input_dir": "input/new_batch"}}
```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
python batch_processor.py
# –°—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é!
```

---

## üìù –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. ‚úÖ –ò–º–ø–æ—Ä—Ç `load_config_with_remote` –¥–æ–±–∞–≤–ª–µ–Ω
2. ‚úÖ Emoji –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ ASCII ([OK], [INFO], [ERROR])
3. ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–∑–º–µ–Ω—ë–Ω: remote > local
4. ‚úÖ `.env` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
5. ‚úÖ Credentials –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

---

## üéØ –†–µ–∑—é–º–µ

**batch_processor.py –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ production!**

- ‚úÖ Remote config —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- ‚úÖ Credentials –∏–∑ .env
- ‚úÖ B2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ 1 —Ñ–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –õ–æ–≥–∏ Windows-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏!** üéä

---

–î–∞—Ç–∞: 1 –¥–µ–∫–∞–±—Ä—è 2025, 14:49  
–°—Ç–∞—Ç—É—Å: ‚úÖ Production Ready  
–¢–µ—Å—Ç: ‚úÖ –£—Å–ø–µ—à–Ω–æ (1 —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω)

